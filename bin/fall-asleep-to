#!/bin/bash

set -euo pipefail

voldown_interval=300
initial_volume=100
silence_file=/home/tog/music/work/2019/ableton-live-library/Samples/silence.flac


while [[ $# > 0 ]]
do
    key="$1"
    case $key in
	-sector)
	    sector="$2"
	    shift
	    ;;
	-recurse)
	    recurse_opt=-recurse
	    ;;
	*)
	    things+=("$key")
	    ;;
    esac
    shift
done

echo Turning volume down every $voldown_interval seconds.

voldown_agent() {
    interval="$1"
    while true ; do
	sleep $interval
	echo -n 9
    done
}

echo "# To initialize volume, playing $(basename "$silence_file") at ${initial_volume}%..."
mplayer -volume "$initial_volume" "$silence_file"
echo "# Okay, now on with whatever you said..."
voldown_agent "$voldown_interval" | mplayer "$@"
